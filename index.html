<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./public/css/style.css">
    <title>Avocado Editor</title>
    <style>
        body{
            font-family: Lato;
        }
        form{
            padding: 3px;
            border: 1px solid;
        }
        form > *{
            display: block;
            margin: 2px;
        }
        .form-title{
            font-size: 1.2rem;
            line-height: 1.5;
        }
        .form-info{
            min-height: 1em;
            color: red;
        }
    </style>
</head>
<body>
<form action="" id="login">
    <p class="form-title">Log in: </p>
    <label for="loginEmail">Email: </label>
    <input type="text" id="loginEmail" autocomplete="email">
    <label for="loginHaslo">Password: </label>
    <input type="password" id="loginHaslo" autocomplete="current-password">
    <span id="loginInfo" class="form-info"></span>
    <button type="submit">Get in!</button>
</form>
<form action="" id="rejestracja">
    <p class="form-title">Register: </p>
    <label for="rejestracjaNazwa">Username: </label>
    <input type="text" id="rejestracjaNazwa" autocomplete="username">
    <label for="rejestracjaEmail">Email address: </label>
    <input type="text" id="rejestracjaEmail" autocomplete="email">
    <label for="rejestracjaHaslo">Password (at least 8 characters): </label>
    <input type="password" id="rejestracjaHaslo" autocomplete="new-password">
    <label for="rejestracjaHasloPowtorz">Confirm password: </label>
    <input type="password" id="rejestracjaHasloPowtorz" autocomplete="new-password">
    <span id="rejestracjaInfo" class="form-info"></span>
    <button type="submit">Create Account!</button>
</form>

<script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-auth.js"></script>

<script src="./public/js/firebase.js"></script>
<script src="./public/js/auth.js"></script>
<script>
    const loginFormularz = document.querySelector("form#login");
    const rejestracjaFormularz = document.querySelector("form#rejestracja");

    loginFormularz.addEventListener("submit", obsluzLogowanie);
    rejestracjaFormularz.addEventListener("submit", obsluzRejestracje);

    async function obsluzLogowanie(zdarzenie){
        zdarzenie.preventDefault();
        const cel = zdarzenie.target;
        const email = cel.querySelector("#loginEmail").value;
        const haslo = cel.querySelector("#loginHaslo").value;
        const infoEl = cel.querySelector("#loginInfo");
        const info = await zalogujUzytkownika(email, haslo);
        infoEl.innerHTML = info;
    }

    async function obsluzRejestracje(zdarzenie){
        zdarzenie.preventDefault();
        const cel = zdarzenie.target;
        const nazwa = cel.querySelector("#rejestracjaNazwa").value;
        const email = cel.querySelector("#rejestracjaEmail").value;
        const haslo = cel.querySelector("#rejestracjaHaslo").value;
        const haslo2 = cel.querySelector("#rejestracjaHasloPowtorz").value;
        const infoEl = cel.querySelector("#rejestracjaInfo");
        let walidacja = walidujRejestracje(nazwa, email, haslo, haslo2).filter(blad => blad.length > 0);
        infoEl.innerHTML = walidacja.length === 0 ? await zarejestrujUzytkownika(nazwa, email, haslo, haslo2) : walidacja.join("<br />");
    }

</script>
</body>
</body>
</html>